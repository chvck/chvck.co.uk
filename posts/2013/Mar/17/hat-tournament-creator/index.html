<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>

  <meta name="description" content="Personal blog site for chvck covering a range of topics but mostly bikes. chvck likes bikes." />
  <META NAME="ROBOTS" CONTENT="INDEX, FOLLOW" />
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  
  <title>Hat Tournament Creator</title>
  <link href="http://chvck.co.uk/theme/css/reset.css" rel="stylesheet" type="text/css" media="screen" />
  <link href="http://chvck.co.uk/theme/css/bootstrap.min.css" rel="stylesheet" type="text/css" media="screen" />
  <link href="http://chvck.co.uk/theme/css/style.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="http://chvck.co.uk/feeds/all.rss" type="application/rss+xml" rel="alternate" title="chvck.co.uk RSS Feed" />
    
  <!--[if IE]>
    <style type="text/css"> 
    . twoColFixRtHdr #mainContent { zoom: 1; }
    </style>
  <![endif]-->

</head>

<body>
  <div class="container">
  
    <header>
      <h1><a href="http://chvck.co.uk">chvck.co.uk</a></h1>
<h2>Pointless, sometimes amusing and deeply, deeply uninteresting to 99.72998% of the population</h2>    </header>

    <nav>
    </nav>
    <aside>
        
      <a href="http://chvck.co.uk/categories.html"><h3>Categories</h3></a>
        <ul>
            <li><a href="http://chvck.co.uk/category/development.html">Development</a></li>
            <li><a href="http://chvck.co.uk/category/fettling.html">Fettling</a></li>
            <li><a href="http://chvck.co.uk/category/multiple-sclerosis.html">Multiple-Sclerosis</a></li>
            <li><a href="http://chvck.co.uk/category/photo-a-day.html">Photo-a-Day</a></li>
            <li><a href="http://chvck.co.uk/category/random.html">Random</a></li>
            <li><a href="http://chvck.co.uk/category/review.html">Review</a></li>
            <li><a href="http://chvck.co.uk/category/riding.html">Riding</a></li>
            <a class="more" href="http://chvck.co.uk/categories.html">View more...</a>
        </ul>

        <h3>Links</h3>
        <ul>
            <li><a href="http://docs.notmyidea.org/alexis/pelican/">Pelican</a></li>
            <li><a href="http://jinja.pocoo.org">Jinja2</a></li>
            <li><a href="http://hatteamcreator.co.uk/">Hat Team Creator</a></li>
            <li><a href="http://27smiles.com">27 Smiles</a></li>
            <li><a href="http://ghickman.co.uk">ghickman.co.uk</a></li>
            <li><a href="http://www.sadedixon.co.uk">sadedixon.co.uk</a></li>
            <li><a href="http://lambdafive.co.uk/">lambdafive.co.uk</a></li>
        </ul>

        <a href="http://chvck.co.uk/tags.html"><h3>Tags</h3></a>
        <ul>
              <li class="tag tag-4"><a href="/tag/pelican.html">pelican</a></li>
              <li class="tag tag-4"><a href="/tag/hackday.html">hackday</a></li>
              <li class="tag tag-4"><a href="/tag/alps.html">alps</a></li>
              <li class="tag tag-4"><a href="/tag/clarach.html">clarach</a></li>
              <li class="tag tag-3"><a href="/tag/boozing.html">boozing</a></li>
              <li class="tag tag-3"><a href="/tag/dev.html">dev</a></li>
              <li class="tag tag-1"><a href="/tag/bikes.html">bikes</a></li>
              <li class="tag tag-2"><a href="/tag/nant-y-arian.html">nant-y-arian</a></li>
              <li class="tag tag-4"><a href="/tag/rough-ride-guide.html">rough-ride-guide</a></li>
              <li class="tag tag-4"><a href="/tag/photo-a-day-2013.html">photo-a-day-2013</a></li>
              <li class="tag tag-4"><a href="/tag/ultimate.html">ultimate</a></li>
              <li class="tag tag-4"><a href="/tag/ridgeway.html">ridgeway</a></li>
              <li class="tag tag-4"><a href="/tag/dyfi.html">dyfi</a></li>
              <li class="tag tag-4"><a href="/tag/wales.html">wales</a></li>
              <li class="tag tag-4"><a href="/tag/eastridge.html">eastridge</a></li>
              <li class="tag tag-1"><a href="/tag/riding.html">riding</a></li>
              <li class="tag tag-3"><a href="/tag/chilterns.html">chilterns</a></li>
              <li class="tag tag-2"><a href="/tag/random.html">random</a></li>
              <li class="tag tag-4"><a href="/tag/javascript.html">javascript</a></li>
              <li class="tag tag-4"><a href="/tag/ms.html">ms</a></li>
              <li class="tag tag-1"><a href="/tag/photo-a-day.html">photo-a-day</a></li>
              <li class="tag tag-4"><a href="/tag/trails.html">trails</a></li>
              <li class="tag tag-4"><a href="/tag/bike-maintenance.html">bike-maintenance</a></li>
        </ul>
        <br style="clear: both"/>
        
        <ul class="socials">
                <li><a href="http://www.twitter.com/chvck"><img class="social" src="http://chvck.co.uk/theme/images/twitter.png" alt="Twitter" ></a></li>
                <li><a href="https://github.com/chvck"><img class="social" src="http://chvck.co.uk/theme/images/github.png" alt="Github" ></a></li>
                <li><a href="http://chvck.co.uk/feeds/all.rss" rel="alternate"><img class="social" src="http://chvck.co.uk/theme/images/RSS_icon.svg" alt="Flex Rss" ></a></li>
        </ul>

    </aside><!-- end #sidebar -->
  
    <div id="mainContent">
      
      
 

  <article class="post">
    <h2><a href="http://chvck.co.uk/posts/2013/Mar/17/hat-tournament-creator/">Hat Tournament Creator</a></h2>
    <h3>Posted on 17 Mar 2013</h3>
        
      <p>I've been meaning to write something about this for a little while now and 2 days ago
I received an email from a tournament organizer in the states so that's prompted me to do this.
He'd found my code on github and wanted to know how to go about running it, well it just so
happens that I actually have it hosted at <a href="http://www.hattournamentcreator.co.uk/">http://www.hattournamentcreator.co.uk/</a>
so I just pointed him at that. I got another email saying that it did what he wanted and that he'll pass the word
on to other organizer. I'm pretty happy that it's helped out at least 2 people in the world now! If it's helping even
a small number of people then it's worth it for me.</p>
<p>So, how it works. First, I'll explain the UI and then a little bit about the back end (at a high level). 
The site allows you to select manual or csv entry, along with an example csv to try to help people out a bit.
Manual entry is frankly crazy as it'd take ages to add any reasonable number of players, I also haven't
tested it as well as I've tested the csv stuff. Anyway, we've selected our csv file (which we already have as we
have to keep a record of players anyway...) and we hit upload. The site then loads all that player data in a big
grid. You can edit players in the grid to change names, metrics, etc... in case of any mistakes. The grid is 
pretty flexible and you can reorder the columns and set the sort order on any of them. You've got your players all setup
so now we need to setup the metrics. This is the important bit, this is how the app will assign points
to players. Each attribute that defines a players skill is given a multiplication factor. Stolen from the site itself:
For example if I was doing this for Ultimate Frisbee then I'd maybe give Cutting a value of 2 and Handling a value of 2 then I'd hit generate formula. 
This'd give me (Cutting * 2) + (Handling * 2).</p>
<p>So Bob who has 3 cutting and 4 handling gets 14 points but Dave who has 1 and 2 respectively gets only 6. At this point we also
need to define how many teams we want creating and whether or not to balance the genders so that all teams
have the same number of girls and the same number of guys. We hit Generate teams, some magic occurs and we get a csv back
that has all of our teams set up for us :). A little example - using the example csv on the website. This example has 4 skill
attributes: cutting, handling, years since playing and years of experience. Years since playing is a negative skill as people get
rusty as the years go by and they haven't played... so I'm going to give that a value of -1. It's not a hugely important attribute
but I want it taken into consideration. I give years of experience 2, it's not that important - I mean you can have played for 10 years
and be rubbish but experience does mean that you know how to react to given situations. Cutting and handling are the big guns,
I'm going to give them 4 each as I feel that they're equally important as one another. 
The point generation formula that I get is: </p>
<p>(Handling * 4) + (Experience * 1) + (Cutting * 4) + (Years Since Playing * -1) </p>
<p>That looks fine to me. I'm going to have 6 teams in this tournament and I want to balance the genders too. 
I hit generate and get my teams back. The teams file also includes a few little extras like the average points
per player for each team. In this example my averages per team are: 16.95, 17.9, 17.4, 18.35, 19.63 and 20.52. That's not 
a huge variance and should make the teams pretty even making for a fun tournament. I feel a bit sorry for Name 68 who has been assigned
-4 points, that's gotta sting! As the player data for this example was literally random numbers (I wrote a script to generate it) I'd expect
real world data to give closer points per team.</p>
<p>Onto how this thing actually works then. The grid is just <a href="http://www.trirand.com/blog/">jqgrid</a> which, tbh, I don't recommend.
When I get round to it I'll rewrite it to use <a href="http://www.datatables.net/">datatables</a>, although I haven't actually tried it yet 
so it could be rubbish! Jqgrid does all the work for the grid stuff so I won't cover that. The algorithm for the team creation is the meat 
so let's talk about that. In my opinion I've used a pretty naive approach and it's probably not the most
optimal way to do it but it works, which is the important bit here. Just to mention, this site uses python and a load of javascript.
The team creation stuff is all in python. My javascript skills are much strong but I like to keep dipping into python just to remember
how it works! Anyway. First we deal with our metrics, we create a dictionary of the attributes that actually map to skills - 
just cast the value to a float and if it's 0 and doesn't throw an exception we class it as a skill! Next up is sorting out the gender stuff,
just determining which gender format is used really. </p>
<p>Onto some of the fun stuff then, the next step is to iterate over every player and work out their points value before adding
the player to the relevant gender array (we need to balance them remember). We quick sort each array so that the highest ranked
players are nearest the "top" (index 0). The next step is to split the array(s) of players into equal sized lists (plus one for
the players that don't fit into the equal lists). The reason for this will become clear now, this effectively means that we have several
lists and each list contains similar skilled players. We now do the actual "teaming". We iterate over our new lists of players one by one. For each
list we generate an index using a weighted random (the weight is linked to how many points the team has, the random is just to add a bit of variance) and then remove the player at that
index and add them to the current selected team. We do this until we've run out of players and then we create and serve the file up.</p>
<p>It's quite hard to explain and the easiest way to see how the algorithm works is to just look at, it's kinda commented!
You can find the code at <a href="https://github.com/chvck/Hat-Team-Generator">https://github.com/chvck/Hat-Team-Generator</a> and main.py and utils.py are the
key files for this stuff. At this point I should probably actually mention why this app was created! A couple of years ago I played
Ultimate Frisbee at Aberystwyth University and the club had its 15th year anniversary. To celebrate this they put on a hat tournament and I
was approached to see if I could make something to create the teams so that the committee didn't have to do it manually. The result
was this web app. Oh, the team I was on also won! No, I didn't fix it either!  </p>	
  <a href="http://twitter.com/share" class="twitter-share-button"
     data-count="horizontal" data-via="chvck">Tweet</a>
  <script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
        
      <h3 class="blogMeta">Posted in: <a href="http://chvck.co.uk/category/web-development.html">Web-Development</a>
        | Tags :
           <span><a href="http://chvck.co.uk/tag/dev.html">dev</a> / </span>
      </h3>
      
  </article>
  
    <article>
        
    <h2>Comments</h2>
    <div id="disqus_thread"></div>
      <script type="text/javascript">
         var disqus_identifier = "posts/2013/Mar/17/hat-tournament-creator/";
         (function () {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'http://chvck.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
      
    </article>
				
    
    </div><!-- end #mainContent -->
  
  <div class="clearfloat"></div>
  
    <footer>
      <p>Proudly powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>, which takes great advantages of <a href="http://python.org">python</a>.
    </footer><!-- end #footer -->
  
  </div><!-- end #container -->
</body>
</html>